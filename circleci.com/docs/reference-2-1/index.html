
<!doctype html>
<html>
  
<!-- Mirrored from circleci.com/docs/reference-2-1/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 12 Jun 2020 08:06:55 GMT -->
<head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>CircleCI 2.1 Configuration Reference Guide</title>
    <link href="images/favicon.ico.png" rel="icon" type="image/png" />

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;shell&quot;]">

    <!-- Analytics Snippet: -->
    <noscript><iframe src="http://www.googletagmanager.com/ns.html?id=GTM-W9HDVK" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= '../../../www.googletagmanager.com/gtm5445.html?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-W9HDVK');</script>

    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <a href="../index.html">
        <img src="images/logo.png" class="logo" alt="Logo" />
      </a>
        <div class="lang-selector">
              <a href="#" data-language-name="shell">shell</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#circleci-2-1-configuration-reference-guide" class="toc-h1 toc-link" data-title="CircleCI 2.1 Configuration Reference Guide">CircleCI 2.1 Configuration Reference Guide</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#overview" class="toc-h2 toc-link" data-title="Overview">Overview</a>
                  </li>
                  <li>
                    <a href="#version" class="toc-h2 toc-link" data-title="version"><strong><code>version</code></strong></a>
                  </li>
                  <li>
                    <a href="#orbs" class="toc-h2 toc-link" data-title="orbs"><strong><code>orbs</code></strong></a>
                  </li>
                  <li>
                    <a href="#commands" class="toc-h2 toc-link" data-title="commands"><strong><code>commands</code></strong></a>
                  </li>
                  <li>
                    <a href="#parameters" class="toc-h2 toc-link" data-title="parameters"><strong><code>parameters</code></strong></a>
                  </li>
                  <li>
                    <a href="#executors" class="toc-h2 toc-link" data-title="executors"><strong><code>executors</code></strong></a>
                  </li>
                  <li>
                    <a href="#jobs" class="toc-h2 toc-link" data-title="jobs"><strong><code>jobs</code></strong></a>
                  </li>
              </ul>
          </li>
      </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='circleci-2-1-configuration-reference-guide'>CircleCI 2.1 Configuration Reference Guide</h1><h2 id='overview'>Overview</h2>
<p>This document is a reference for the CircleCI 2.1 configuration keys used in the <code>config.yml</code> file. The presence of a <code>.circleci/config.yml</code> file in your CircleCI-authorized repository branch indicates you want to use the 2.x infrastructure.</p>
<h2 id='version'><strong><code>version</code></strong></h2>
<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>version</td>
<td>Y</td>
<td>String</td>
<td><code>2</code>, <code>2.0</code>, or <code>2.1</code> See the <a href="../2.0/reusing-config/index.html#section=configuration">Reusing Config</a> doc for an overview of new 2.1 keys available to simplify your <code>.circleci/config.yml</code> file, reuse, and parameterized jobs.</td>
</tr>
</tbody></table>

<p>The <code>version</code> field is intended to be used in order to issue warnings for deprecation or breaking changes.</p>
<h2 id='orbs'><strong><code>orbs</code></strong></h2>
<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>orbs</td>
<td>N</td>
<td>Map</td>
<td>A map of user-selected names to either: orb references (strings) or orb definitions (maps). Orb definitions must be the orb-relevant subset of 2.1 config. See the <a href="../2.0/orb-author/index.html#section=configuration">Authoring Orbs</a> documentation for details.</td>
</tr>
<tr>
<td>executors</td>
<td>N</td>
<td>Map</td>
<td>A map of strings to executor definitions. See the <a href="../2.0/configuration-reference/index.html#executors-requires-version-21">Executors</a> section below.</td>
</tr>
<tr>
<td>commands</td>
<td>N</td>
<td>Map</td>
<td>A map of command names to command definitions. See the <a href="../2.0/configuration-reference/index.html#commands-requires-version-21">Commands</a> section below.</td>
</tr>
</tbody></table>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">orbs</span><span class="pi">:</span>
    <span class="na">hello</span><span class="pi">:</span> <span class="s">circleci/hello-build@0.0.5</span>
<span class="na">workflows</span><span class="pi">:</span>
    <span class="s2">"</span><span class="s">Hello</span><span class="nv"> </span><span class="s">Workflow"</span><span class="pi">:</span>
        <span class="na">jobs</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">hello/hello-build</span>
</code></pre>
<p>In this example, <code>hello</code> is considered the orbs reference; whereas <code>circleci/hello-build@0.0.5</code> is the fully-qualified orb reference.</p>
<h2 id='commands'><strong><code>commands</code></strong></h2>
<p>A command definition defines a sequence of steps as a map to be executed in a job, enabling you to reuse a single command definition across multiple jobs.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>steps</td>
<td>Y</td>
<td>Sequence</td>
<td>A sequence of steps run inside the calling job of the command.</td>
</tr>
<tr>
<td>parameters</td>
<td>N</td>
<td>Map</td>
<td>A map of parameter keys. See the <a href="../2.0/reusing-config/index.html#parameter-syntax">Parameter Syntax</a> section of the <a href="../2.0/reusing-config/index.html#section=configuration">Reusing Config</a> document for details.</td>
</tr>
<tr>
<td>description</td>
<td>N</td>
<td>String</td>
<td>A string that describes the purpose of the command.</td>
</tr>
</tbody></table>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">commands</span><span class="pi">:</span>
  <span class="na">sayhello</span><span class="pi">:</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">A</span><span class="nv"> </span><span class="s">very</span><span class="nv"> </span><span class="s">simple</span><span class="nv"> </span><span class="s">command</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">demonstration</span><span class="nv"> </span><span class="s">purposes"</span>
    <span class="na">parameters</span><span class="pi">:</span>
      <span class="na">to</span><span class="pi">:</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
        <span class="na">default</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Hello</span><span class="nv"> </span><span class="s">World"</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">echo &lt;&lt; parameters.to &gt;&gt;</span>
</code></pre><h2 id='parameters'><strong><code>parameters</code></strong></h2>
<p>Pipeline parameters declared for use in the configuration. See <a href="../2.0/pipeline-variables/index.html#pipeline-parameters-in-configuration">Pipeline Variables</a> for usage details.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>parameters</td>
<td>N</td>
<td>Map</td>
<td>A map of parameter keys. Supports <code>string</code>, <code>boolean</code>, <code>integer</code> and <code>enum</code> types. See <a href="../2.0/reusing-config/index.html#parameter-syntax">Parameter Syntax</a> for details.</td>
</tr>
</tbody></table>
<h2 id='executors'><strong><code>executors</code></strong></h2>
<p>Executors define the environment in which the steps of a job will be run, allowing you to reuse a single executor definition across multiple jobs.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>docker</td>
<td>Y <sup>(1)</sup></td>
<td>List</td>
<td>Options for <a href="#docker">docker executor</a></td>
</tr>
<tr>
<td>resource_class</td>
<td>N</td>
<td>String</td>
<td>Amount of CPU and RAM allocated to each container in a job. <strong>Note:</strong> A paid account is required to access this feature. Customers on paid container-based plans can request access by <a href="https://support.circleci.com/hc/en-us/requests/new">opening a support ticket</a>.</td>
</tr>
<tr>
<td>machine</td>
<td>Y <sup>(1)</sup></td>
<td>Map</td>
<td>Options for <a href="#machine">machine executor</a></td>
</tr>
<tr>
<td>macos</td>
<td>Y <sup>(1)</sup></td>
<td>Map</td>
<td>Options for <a href="#macos">macOS executor</a></td>
</tr>
<tr>
<td>windows</td>
<td>Y <sup>(1)</sup></td>
<td>Map</td>
<td>Options for <a href="#windows">windows executor</a></td>
</tr>
<tr>
<td>shell</td>
<td>N</td>
<td>String</td>
<td>Shell to use for execution command in all steps. Can be overridden by <code>shell</code> in each step (default: See <a href="#default-shell-options">Default Shell Options</a>)</td>
</tr>
<tr>
<td>working_directory</td>
<td>N</td>
<td>String</td>
<td>In which directory to run the steps.</td>
</tr>
<tr>
<td>environment</td>
<td>N</td>
<td>Map</td>
<td>A map of environment variable names and values.</td>
</tr>
</tbody></table>

<p><sup>(1)</sup> One executor type should be specified per job. If more than one is set you will receive an error.</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">executors</span><span class="pi">:</span>
  <span class="na">my-executor</span><span class="pi">:</span>
    <span class="na">docker</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">circleci/ruby:2.5.1-node-browsers</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">my-job</span><span class="pi">:</span>
    <span class="na">executor</span><span class="pi">:</span> <span class="s">my-executor</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">echo outside the executor</span>
</code></pre>
<p>See the <a href="../2.0/reusing-config/index.html#using-parameters-in-executors">Using Parameters in Executors</a> section of the <a href="../2.0/reusing-config/index.html#section=configuration">Reusing Config</a> document for examples of parameterized executors.</p>
<h2 id='jobs'><strong><code>jobs</code></strong></h2>
<p>A run is comprised of one or more named jobs. The name of the job is the key in the map, and the value is a map describing the job.</p>

<p>If you are using <a href="%7b%7b%20https_/circleci.com/docs/2.0/workflows/index.html">Workflows</a>, jobs must have unique names within the <code>.circleci/config.yml</code> file.</p>

<p>If you are <strong>not</strong> using workflows, the <code>jobs</code> map must contain a job named <code>build</code>. This <code>build</code> job is the default entry-point for a run that is triggered by a push to your VCS provider. It is possible to then specify additional jobs and run them using the CircleCI API.</p>

<p><strong>Note:</strong>
Jobs have a maximum runtime of 5 hours. If your jobs are timing out, consider running some of them concurrently using <a href="../2.0/workflows/index.html">workflows</a>.</p>
<h3 id='lt-job_name-gt'><strong>&lt;<code>job_name</code>&gt;</strong></h3>
<p>Each job consists of the job&#39;s name as a key and a map as a value. A name should be unique within a current <code>jobs</code> list. The value map has the following attributes:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>docker</td>
<td>Y <sup>(1)</sup></td>
<td>List</td>
<td>Options for <a href="#docker">docker executor</a></td>
</tr>
<tr>
<td>machine</td>
<td>Y <sup>(1)</sup></td>
<td>Map</td>
<td>Options for <a href="#machine">machine executor</a></td>
</tr>
<tr>
<td>macos</td>
<td>Y <sup>(1)</sup></td>
<td>Map</td>
<td>Options for <a href="#macos">macOS executor</a></td>
</tr>
<tr>
<td>shell</td>
<td>N</td>
<td>String</td>
<td>Shell to use for execution command in all steps. Can be overridden by <code>shell</code> in each step (default: See <a href="#default-shell-options">Default Shell Options</a>)</td>
</tr>
<tr>
<td>parameters</td>
<td>N</td>
<td>Map</td>
<td>A map of parameters that need to be passed as part of the request when performing this operation</td>
</tr>
<tr>
<td>steps</td>
<td>Y</td>
<td>List</td>
<td>A list of <a href="#steps">steps</a> to be performed</td>
</tr>
<tr>
<td>working_directory</td>
<td>N</td>
<td>String</td>
<td>The directory used to run the steps. Default: <code>~/project</code> (where <code>project</code> is a literal string, not the name of your specific project). Processes run during the job can use the <code>$CIRCLE_WORKING_DIRECTORY</code> environment variable to refer to this directory. <strong>Note:</strong> Paths written in your YAML configuration file will <em>not</em> be expanded; if your <code>store_test_results.path</code> is <code>$CIRCLE_WORKING_DIRECTORY/tests</code>, then CircleCI will attempt to store the <code>test</code> subdirectory of the directory literally named <code>$CIRCLE_WORKING_DIRECTORY</code>, dollar sign <code>$</code> and all.</td>
</tr>
<tr>
<td>parallelism</td>
<td>N</td>
<td>Integer</td>
<td>Number of parallel instances of this job to run (default: 1)</td>
</tr>
<tr>
<td>environment</td>
<td>N</td>
<td>Map</td>
<td>A map of environment variable names and values.</td>
</tr>
<tr>
<td>resource_class</td>
<td>N</td>
<td>String</td>
<td>Amount of CPU and RAM allocated to each container in a job. <strong>Note:</strong> A paid account is required to access this feature. Customers on paid container-based plans can request access by <a href="https://support.circleci.com/hc/en-us/requests/new">opening a support ticket</a>.</td>
</tr>
</tbody></table>

<p>One executor type should be specified per job. If more than one is set, you will receive an error.</p>
<h4 id='environment'><code>environment</code></h4>
<p>A map of environment variable names and values. These will override any environment variables you set in the CircleCI application.</p>
<h4 id='parallelism'><code>parallelism</code></h4>
<p>If <code>parallelism</code> is set to N &gt; 1, then N independent executors will be set up and each will run the steps of that job in parallel. This can help optimize your test steps; you can split your test suite, using the CircleCI CLI, across parallel containers so the job will complete in a shorter time. Certain parallelism-aware steps can opt out of the parallelism and only run on a single executor (for example <a href="#deploy"><code>deploy</code> step</a>). Learn more about <a href="../2.0/parallelism-faster-jobs/index.html#section=projects">parallel jobs</a>.</p>

<p>Note that <code>working_directory</code> will be created automatically if it does not exist.</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">docker</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">buildpack-deps:trusty</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">FOO</span><span class="pi">:</span> <span class="s">bar</span>
    <span class="na">parallelism</span><span class="pi">:</span> <span class="s">3</span>
    <span class="na">resource_class</span><span class="pi">:</span> <span class="s">large</span>
    <span class="na">working_directory</span><span class="pi">:</span> <span class="s">~/my-app</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">go test -v $(go list ./... | circleci tests split)</span>
</code></pre><h3 id='docker-machine-macos-windows-executor'><strong><code>docker</code></strong> / <strong><code>machine</code></strong> / <strong><code>macos</code></strong> / <strong><code>windows</code></strong> (<em>executor</em>)</h3>
<p>An &quot;executor&quot; is roughly &quot;a place where steps occur&quot;. CircleCI 2.0 can build the necessary environment by launching as many docker containers as needed at once, or it can use a full virtual machine. Learn more about <a href="../2.0/executor-types/index.html">different executors</a>.</p>
<h4 id='docker'><code>docker</code></h4>
<p>Configured by the <code>docker</code> key which takes a list of maps:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>image</td>
<td>Y</td>
<td>String</td>
<td>The name of a custom docker image to use</td>
</tr>
<tr>
<td>name</td>
<td>N</td>
<td>String</td>
<td>The name the container is reachable by.  By default, container services are accessible through <code>localhost</code></td>
</tr>
<tr>
<td>entrypoint</td>
<td>N</td>
<td>String or List</td>
<td>The command used as executable when launching the container</td>
</tr>
<tr>
<td>command</td>
<td>N</td>
<td>String or List</td>
<td>The command used as pid 1 (or args for entrypoint) when launching the container</td>
</tr>
<tr>
<td>user</td>
<td>N</td>
<td>String</td>
<td>Which user to run commands as within the Docker container</td>
</tr>
<tr>
<td>environment</td>
<td>N</td>
<td>Map</td>
<td>A map of environment variable names and values</td>
</tr>
<tr>
<td>auth</td>
<td>N</td>
<td>Map</td>
<td>Authentication for registries using standard <code>docker login</code> credentials</td>
</tr>
<tr>
<td>aws_auth</td>
<td>N</td>
<td>Map</td>
<td>Authentication for AWS EC2 Container Registry (ECR)</td>
</tr>
</tbody></table>

<p>The first <code>image</code> listed in the file defines the primary container image where all steps will run.</p>

<p><code>entrypoint</code> overrides default entrypoint from Dockerfile.</p>

<p><code>command</code> will be used as arguments to image entrypoint (if specified in Dockerfile) or as executable (if no entrypoint is provided here or in the Dockerfile).</p>

<p>For <a href="%7b%7b%20site.baseurl%20%7d%7d/2.0/glossary/index.html#primary-container">primary container</a> (listed first in the list) if no <code>command</code> is specified then <code>command</code> and image entrypoint will be ignored, to avoid errors caused by the entrypoint executable consuming significant resources or exiting prematurely. At this time, all <code>steps</code> are run in the primary container only.</p>

<p>The <code>name</code> string defines the name for reaching the secondary service containers. By default, all services are exposed directly on <code>localhost</code>. The field is appropriate if you would rather have a different host name instead of localhost, for example, if you are starting multiple versions of the same service.</p>

<p>The <code>environment</code> settings apply to all commands run in this executor, not just the initial <code>command</code>. The <code>environment</code> has higher precedence over setting it in the job map above.</p>

<p>You can specify image versions using tags or digest. You can use any public images from any public Docker registry (defaults to Docker Hub). Learn more about <a href="../2.0/executor-types/index.html">specifying images</a>.</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">docker</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">buildpack-deps:trusty</span> <span class="c1"># primary container</span>
        <span class="na">environment</span><span class="pi">:</span>
          <span class="na">ENV</span><span class="pi">:</span> <span class="s">CI</span>

      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">mongo:2.6.8</span>
        <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">--smallfiles</span><span class="pi">]</span>

      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">postgres:9.4.1</span>
        <span class="na">environment</span><span class="pi">:</span>
          <span class="na">POSTGRES_USER</span><span class="pi">:</span> <span class="s">root</span>

      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">redis@sha256:54057dd7e125ca41afe526a877e8bd35ec2cdd33b9217e022ed37bdcf7d09673</span>
</code></pre>
<p>If you are using a private image, you can specify the username and password in the <code>auth</code> field. To protect the password, you can set it as a project setting.</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">docker</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">acme-private/private-image:321</span>
        <span class="na">auth</span><span class="pi">:</span>
          <span class="na">username</span><span class="pi">:</span> <span class="s">mydockerhub-user</span>  <span class="c1"># can specify string literal values</span>
          <span class="na">password</span><span class="pi">:</span> <span class="s">$DOCKERHUB_PASSWORD</span>  <span class="c1"># or project UI env-var reference</span>
</code></pre>
<p>Using an image hosted on <a href="https://aws.amazon.com/ecr/">AWS ECR</a> requires authentication using AWS credentials. By default, CircleCI uses the AWS credentials that you add to the Project &gt; Settings &gt; AWS Permissions page in the CircleCI application, or by setting the <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> project environment variables. It is also possible to set the credentials by using <code>aws_auth</code> field.</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">docker</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">account-id.dkr.ecr.us-east-1.amazonaws.com/org/repo:0.1</span>
        <span class="na">aws_auth</span><span class="pi">:</span>
          <span class="na">aws_access_key_id</span><span class="pi">:</span> <span class="s">AKIAQWERVA</span>  <span class="c1"># can specify string literal values</span>
          <span class="na">aws_secret_access_key</span><span class="pi">:</span> <span class="s">$ECR_AWS_SECRET_ACCESS_KEY</span>  <span class="c1"># or project UI envar reference</span>
</code></pre>
<p>It is possible to reuse <a href="../2.0/reusing-config/index.html">declared commands</a> in a job when using version 2.1. This example invokes the <code>sayhello</code> command.</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">myjob</span><span class="pi">:</span>
    <span class="na">docker</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s2">"</span><span class="s">circleci/node:9.6.1"</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">sayhello</span><span class="pi">:</span>
          <span class="na">to</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Lev"</span>
</code></pre><h4 id='machine'><strong><code>machine</code></strong></h4>
<p>The <a href="../2.0/executor-types/index.html">machine executor</a> is configured by using the <code>machine</code> key, which takes a map:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>image</td>
<td>Y</td>
<td>String</td>
<td>The VM image to use. View <a href="#available-machine-images">available images</a>. <strong>Note:</strong> This key is <strong>not</strong> supported on the installable CircleCI. For information about customizing <code>machine</code> executor images on CircleCI installed on your servers, see our <a href="../2.0/vm-service/index.html">VM Service documentation</a>.</td>
</tr>
<tr>
<td>docker_layer_caching</td>
<td>N</td>
<td>Boolean</td>
<td>Set to <code>true</code> to enable <a href="../2.0/docker-layer-caching/index.html">Docker Layer Caching</a>. <strong>Note:</strong> You must open a support ticket to have a CircleCI Sales representative contact you about enabling this feature on your account for an additional fee.</td>
</tr>
</tbody></table>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">machine</span><span class="pi">:</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">ubuntu-1604:201903-01</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">checkout</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Testing"</span>
          <span class="na">command</span><span class="pi">:</span> <span class="s">echo "Hi"</span>
</code></pre><h5 id='available-machine-images'>Available <code>machine</code> images</h5>
<p>CircleCI supports multiple machine images that can be specified in the <code>image</code> field:</p>

<ul>
<li><code>ubuntu-1604:201903-01</code> - Ubuntu 16.04, docker 18.09.3, docker-compose 1.23.1</li>
<li><code>circleci/classic:latest</code> (old default) - an Ubuntu version <code>14.04</code> image that includes Docker version <code>17.09.0-ce</code> and docker-compose version <code>1.14.0</code>, along with common language tools found in CircleCI 1.0 build image. Changes to the <code>latest</code> image are <a href="https://discuss.circleci.com/t/how-to-subscribe-to-announcements-and-notifications-from-circleci-email-rss-json/5616">announced</a> at least a week in advance. Ubuntu 14.04 is now End-of-Life&#39;d. We suggest using the Ubuntu 16.04 image.</li>
<li><code>circleci/classic:edge</code> - an Ubuntu version <code>14.04</code> image with Docker version <code>17.10.0-ce</code> and docker-compose version <code>1.16.1</code>, along with common language tools found in CircleCI 1.0 build image.</li>
<li><code>circleci/classic:201703-01</code> – docker 17.03.0-ce, docker-compose 1.9.0</li>
<li><code>circleci/classic:201707-01</code> – docker 17.06.0-ce, docker-compose 1.14.0</li>
<li><code>circleci/classic:201708-01</code> – docker 17.06.1-ce, docker-compose 1.14.0</li>
<li><code>circleci/classic:201709-01</code> – docker 17.07.0-ce, docker-compose 1.14.0</li>
<li><code>circleci/classic:201710-01</code> – docker 17.09.0-ce, docker-compose 1.14.0</li>
<li><code>circleci/classic:201710-02</code> – docker 17.10.0-ce, docker-compose 1.16.1</li>
<li><code>circleci/classic:201711-01</code> – docker 17.11.0-ce, docker-compose 1.17.1</li>
<li><code>circleci/classic:201808-01</code> – docker 18.06.0-ce, docker-compose 1.22.0</li>
</ul>

<p>The machine executor supports <a href="../2.0/docker-layer-caching/index.html">Docker Layer Caching</a> which is useful when you are building Docker images during your job or Workflow.</p>
<h5 id='available-linux-gpu-images'>Available Linux GPU images</h5>
<p>When using the <a href="#gpu-executor-linux">Linux GPU executor</a>, the available images are:</p>

<ul>
<li><code>ubuntu-1604-cuda-10.1:201909-23</code> - CUDA 10.1, docker 19.03.0-ce, nvidia-docker 2.2.2</li>
<li><code>ubuntu-1604-cuda-9.2:201909-23</code> - CUDA 9.2, docker 19.03.0-ce, nvidia-docker 2.2.2</li>
</ul>
<h5 id='available-windows-gpu-image'>Available Windows GPU image</h5>
<p>When using the <a href="#gpu-executor-windows">Windows GPU executor</a>, the available image is:</p>

<ul>
<li><code>windows-server-2019-nvidia:stable</code> - Windows Server 2019, CUDA 10.1.
This image is the default.</li>
</ul>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">workflows</span><span class="pi">:</span>
  <span class="na">main</span><span class="pi">:</span>
    <span class="na">jobs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">build</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">machine</span><span class="pi">:</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">ubuntu-1604:201903-01</span>
      <span class="na">docker_layer_caching</span><span class="pi">:</span> <span class="s">true</span>    <span class="c1"># default - false</span>
</code></pre><h4 id='macos'><strong><code>macos</code></strong></h4>
<p>CircleCI supports running jobs on <a href="https://developer.apple.com/macos/">macOS</a>, to allow you to build, test, and deploy apps for macOS, <a href="https://developer.apple.com/ios/">iOS</a>, <a href="https://developer.apple.com/tvos/">tvOS</a> and <a href="https://developer.apple.com/watchos/">watchOS</a>. To run a job in a macOS virtual machine, you must add the <code>macos</code> key to the top-level configuration for the job and specify the version of Xcode you would like to use.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>xcode</td>
<td>Y</td>
<td>String</td>
<td>The version of Xcode installed on the virtual machine. See the <a href="../2.0/testing-ios/index.html#supported-xcode-versions">Supported Xcode Versions section of the Testing iOS</a> document for the complete list.</td>
</tr>
</tbody></table>

<p>Use a macOS virtual machine with Xcode version 11.3:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">macos</span><span class="pi">:</span>
      <span class="na">xcode</span><span class="pi">:</span> <span class="s2">"</span><span class="s">11.3.0"</span>
</code></pre><h4 id='windows'><strong><code>windows</code></strong></h4>
<p>CircleCI supports running jobs on Windows. To run a job on a Windows machine, you must add the <code>windows</code> key to the top-level configuration for the job. Orbs also provide easy access to setting up a Windows job. To learn more about prerequisites to running Windows jobs and what Windows machines can offer, consult the <a href="../2.0/hello-world-windows/index.html">Hello World on Windows</a> document.</p>

<p>Use a windows executor to run a simple job.</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">orbs</span><span class="pi">:</span>
  <span class="na">win</span><span class="pi">:</span> <span class="s">circleci/windows@2.3.0</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">executor</span><span class="pi">:</span> <span class="s">win/default</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">checkout</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">echo 'Hello, Windows'</span>
</code></pre><h4 id='branches'><strong><code>branches</code></strong></h4>
<p>Defines rules for allowing/blocking execution of some branches if Workflows are <strong>not</strong> configured and you are using 2.0 (not 2.1) config. If you are using <a href="../2.0/workflows/index.html#using-contexts-and-filtering-in-your-workflows">Workflows</a>, job-level branches will be ignored and must be configured in the Workflows section of your <code>config.yml</code> file. If you are using 2.1 config, you will need to add a workflow in order to use filtering. See the <a href="#workflows">workflows</a> section for details. The job-level <code>branch</code> key takes a map:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>only</td>
<td>N</td>
<td>List</td>
<td>List of branches that only will be executed</td>
</tr>
<tr>
<td>ignore</td>
<td>N</td>
<td>List</td>
<td>List of branches to ignore</td>
</tr>
</tbody></table>

<p>Both <code>only</code> and <code>ignore</code> lists can have full names and regular expressions. Regular expressions must match the <strong>entire</strong> string.</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
      <span class="na">only</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">master</span>
        <span class="pi">-</span> <span class="s">/rc-.*/</span>
</code></pre>
<p>In this case, only &quot;master&quot; branch and branches matching regex &quot;rc-.*&quot; will be executed.</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
      <span class="na">ignore</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">develop</span>
        <span class="pi">-</span> <span class="s">/feature-.*/</span>
</code></pre>
<p>In this example, all branches will be executed except &quot;develop&quot; and branches matching regex &quot;feature-.*&quot;.</p>

<p>If both <code>ignore</code> and <code>only</code> are present in config, only <code>ignore</code> will be taken into account.</p>

<p>A job that was not executed due to configured rules will show up in the list of jobs in UI, but will be marked as skipped.</p>

<p>To ensure the job runs for <strong>all</strong> branches, either do not use the <code>branches</code> key, or use the <code>only</code> key along with the regular expression: <code>/.*/</code> to catch all branches.</p>
<h4 id='resource_class'><strong><code>resource_class</code></strong></h4>
<p>The <code>resource_class</code> feature allows configuring CPU and RAM resources for each job. Different resource classes are available for different executors, as described in the tables below. <strong>For self-hosted installations of CircleCI Server contact your system administrator for a list of available resource classes</strong>.</p>

<p>CircleCI implements soft concurrency limits for each resource class to ensure the system remains stable for all customers. If you are on a Performance or Custom plan and experience queuing for certain resource classes, it is possible you are hitting these limits. <a href="https://support.circleci.com/hc/en-us/requests/new">Contact CircleCI support</a> to request a raise on these limits for your account.</p>

<p><strong>Note:</strong> This feature is automatically enabled on Free and Performance plans. Available resources classes are restricted for customers on the free plan to small/medium for linux, and medium for Windows. MacOS is not yet available on the free plan. If you are on a container plan, you will need to <a href="https://support.circleci.com/hc/en-us/requests/new">open a support ticket</a> and speak with a CircleCI Sales representative about enabling this feature.</p>
<h5 id='docker-executor'>Docker Executor</h5>
<table><thead>
<tr>
<th>Class</th>
<th>vCPUs</th>
<th>RAM</th>
</tr>
</thead><tbody>
<tr>
<td>small</td>
<td>1</td>
<td>2GB</td>
</tr>
<tr>
<td>medium (default)</td>
<td>2</td>
<td>4GB</td>
</tr>
<tr>
<td>medium+</td>
<td>3</td>
<td>6GB</td>
</tr>
<tr>
<td>large</td>
<td>4</td>
<td>8GB</td>
</tr>
<tr>
<td>xlarge</td>
<td>8</td>
<td>16GB</td>
</tr>
<tr>
<td>2xlarge<sup>(2)</sup></td>
<td>16</td>
<td>32GB</td>
</tr>
<tr>
<td>2xlarge+<sup>(2)</sup></td>
<td>20</td>
<td>40GB</td>
</tr>
</tbody></table>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">docker</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">buildpack-deps:trusty</span>
    <span class="na">resource_class</span><span class="pi">:</span> <span class="s">xlarge</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="s">... // other config</span>
</code></pre><h5 id='machine-executor-linux'>Machine Executor (Linux)</h5>
<table><thead>
<tr>
<th>Class</th>
<th>vCPUs</th>
<th>RAM</th>
</tr>
</thead><tbody>
<tr>
<td>medium (default)</td>
<td>2</td>
<td>7.5GB</td>
</tr>
<tr>
<td>large</td>
<td>4</td>
<td>15GB</td>
</tr>
<tr>
<td>xlarge</td>
<td>8</td>
<td>32GB</td>
</tr>
<tr>
<td>2xlarge</td>
<td>16</td>
<td>64GB</td>
</tr>
</tbody></table>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">machine</span><span class="pi">:</span> <span class="s">true</span>
    <span class="na">resource_class</span><span class="pi">:</span> <span class="s">large</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="s">... // other config</span>
</code></pre><h5 id='macos-executor'>macOS Executor</h5>
<table><thead>
<tr>
<th>Class</th>
<th>vCPUs</th>
<th>RAM</th>
</tr>
</thead><tbody>
<tr>
<td>medium (default)</td>
<td>4</td>
<td>8GB</td>
</tr>
<tr>
<td>large<sup>(2)</sup></td>
<td>8</td>
<td>16GB</td>
</tr>
</tbody></table>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">macos</span><span class="pi">:</span>
      <span class="na">xcode</span><span class="pi">:</span> <span class="s2">"</span><span class="s">11.3.0"</span>
    <span class="na">resource_class</span><span class="pi">:</span> <span class="s">large</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="s">... // other config</span>
</code></pre><h5 id='windows-executor'>Windows Executor</h5>
<table><thead>
<tr>
<th>Class</th>
<th>vCPUs</th>
<th>RAM</th>
</tr>
</thead><tbody>
<tr>
<td>medium (default)</td>
<td>4</td>
<td>15GB</td>
</tr>
<tr>
<td>large</td>
<td>8</td>
<td>30GB</td>
</tr>
<tr>
<td>xlarge</td>
<td>16</td>
<td>60GB</td>
</tr>
<tr>
<td>2xlarge</td>
<td>32</td>
<td>128GB</td>
</tr>
</tbody></table>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">orbs</span><span class="pi">:</span>
  <span class="na">win</span><span class="pi">:</span> <span class="s">circleci/windows@2.3.0</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">executor</span><span class="pi">:</span> <span class="s">win/default</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">Write-Host 'Hello, Windows'</span>
</code></pre>
<p>See the <a href="../2.0/hello-world-windows/index.html">Windows Getting Started document</a> for more details and examples of using the Windows executor.</p>
<h5 id='gpu-executor-linux'>GPU Executor (Linux)</h5>
<table><thead>
<tr>
<th>Class</th>
<th>vCPUs</th>
<th>RAM</th>
<th>GPUs</th>
<th>GPU model</th>
<th>GPU Memory (GiB)</th>
</tr>
</thead><tbody>
<tr>
<td>gpu.nvidia.small<sup>(2)</sup></td>
<td>4</td>
<td>15</td>
<td>1</td>
<td>Nvidia Tesla P4</td>
<td>8</td>
</tr>
<tr>
<td>gpu.nvidia.medium<sup>(2)</sup></td>
<td>8</td>
<td>30</td>
<td>1</td>
<td>Nvidia Tesla T4</td>
<td>16</td>
</tr>
</tbody></table>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">machine</span><span class="pi">:</span>
      <span class="na">resource_class</span><span class="pi">:</span> <span class="s">gpu.nvidia.small</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">ubuntu-1604-cuda-10.1:201909-23</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">nvidia-smi</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">docker run --gpus all nvidia/cuda:9.0-base nvidia-smi</span>
</code></pre>
<p>See the <a href="#available-linux-gpu-images">Available Linux GPU images</a> section for the full list of available images.</p>
<h5 id='gpu-executor-windows'>GPU Executor (Windows)</h5>
<table><thead>
<tr>
<th>Class</th>
<th>vCPUs</th>
<th>RAM</th>
<th>GPUs</th>
<th>GPU model</th>
<th>GPU Memory (GiB)</th>
</tr>
</thead><tbody>
<tr>
<td>windows.gpu.nvidia.medium<sup>(2)</sup></td>
<td>8</td>
<td>30</td>
<td>1</td>
<td>Nvidia Tesla T4</td>
<td>16</td>
</tr>
</tbody></table>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">orbs</span><span class="pi">:</span>
  <span class="na">win</span><span class="pi">:</span> <span class="s">circleci/windows@2.3.0</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">executor</span><span class="pi">:</span> <span class="s">win/gpu-nvidia</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">checkout</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s1">'</span><span class="s">&amp;"C:\Program</span><span class="nv"> </span><span class="s">Files\NVIDIA</span><span class="nv"> </span><span class="s">Corporation\NVSMI\nvidia-smi.exe"'</span>
</code></pre>
<p><em>This resource requires review by our support team. <a href="https://support.circleci.com/hc/en-us/requests/new">Open a support ticket</a> if you would like to request access.</em></p>

<p><strong>Note</strong>: Java, Erlang and any other languages that introspect the <code>/proc</code> directory for information about CPU count may require additional configuration to prevent them from slowing down when using the CircleCI 2.0 resource class feature. Programs with this issue may request 32 CPU cores and run slower than they would when requesting one core. Users of languages with this issue should pin their CPU count to their guaranteed CPU resources.
If you want to confirm how much memory you have been allocated, you can check the cgroup memory hierarchy limit with <code>grep hierarchical_memory_limit /sys/fs/cgroup/memory/memory.stat</code>.</p>
<h4 id='steps'><strong><code>steps</code></strong></h4>
<p>The <code>steps</code> setting in a job should be a list of single key/value pairs, the key of which indicates the step type. The value may be either a configuration map or a string (depending on what that type of step requires).</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">working_directory</span><span class="pi">:</span> <span class="s">~/canary-python</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">FOO</span><span class="pi">:</span> <span class="s">bar</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">Running tests</span>
          <span class="na">command</span><span class="pi">:</span> <span class="s">make test</span>
</code></pre>
<p>In this example, <code>run</code> is a step type. The <code>name</code> attribute is used by the UI for display purposes. The <code>command</code> attribute is specific for <code>run</code> step and defines command to execute.</p>

<p>Some steps may implement a shorthand semantic. For example, <code>run</code> may be also be called like this:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">make test</span>
</code></pre>
<p>In its short form, the <code>run</code> step allows us to directly specify which <code>command</code> to execute as a string value. In this case step itself provides default suitable values for other attributes (<code>name</code> here will have the same value as <code>command</code>, for example).</p>

<p>Another shorthand, which is possible for some steps, is to simply use the step name as a string instead of a key/value pair:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">checkout</span>
</code></pre>
<p>In this case, the <code>checkout</code> step will checkout project source code into the job&#39;s <a href="#jobs"><code>working_directory</code></a>.</p>

<p>In general all steps can be described as:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>&lt;step_type&gt;</td>
<td>Y</td>
<td>Map or String</td>
<td>A configuration map for the step or some string whose semantics are defined by the step.</td>
</tr>
</tbody></table>

<p>Each built-in step is described in detail below.</p>
<h5 id='run'><strong><code>run</code></strong></h5>
<p>Used for invoking all command-line programs, taking either a map of configuration values, or, when called in its short-form, a string that will be used as both the <code>command</code> and <code>name</code>. Run commands are executed using non-login shells by default, so you must explicitly source any dotfiles as part of the command.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>command</td>
<td>Y</td>
<td>String</td>
<td>Command to run via the shell</td>
</tr>
<tr>
<td>name</td>
<td>N</td>
<td>String</td>
<td>Title of the step to be shown in the CircleCI UI (default: full <code>command</code>)</td>
</tr>
<tr>
<td>shell</td>
<td>N</td>
<td>String</td>
<td>Shell to use for execution command (default: See <a href="#default-shell-options">Default Shell Options</a>)</td>
</tr>
<tr>
<td>environment</td>
<td>N</td>
<td>Map</td>
<td>Additional environmental variables, locally scoped to command</td>
</tr>
<tr>
<td>background</td>
<td>N</td>
<td>Boolean</td>
<td>Whether or not this step should run in the background (default: false)</td>
</tr>
<tr>
<td>working_directory</td>
<td>N</td>
<td>String</td>
<td>In which directory to run this step (default:  <a href="#jobs"><code>working_directory</code></a> of the job)</td>
</tr>
<tr>
<td>no_output_timeout</td>
<td>N</td>
<td>String</td>
<td>Elapsed time the command can run without output. The string is a decimal with unit suffix, such as &quot;20m&quot;, &quot;1.25h&quot;, &quot;5s&quot; (default: 10 minutes)</td>
</tr>
<tr>
<td>when</td>
<td>N</td>
<td>String</td>
<td><a href="#the-when-attribute">Specify when to enable or disable the step</a>. Takes the following values: <code>always</code>, <code>on_success</code>, <code>on_fail</code> (default: <code>on_success</code>)</td>
</tr>
</tbody></table>

<p>Each <code>run</code> declaration represents a new shell. It&#39;s possible to specify a multi-line <code>command</code>, each line of which will be run in the same shell:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="pi">-</span> <span class="na">run</span><span class="pi">:</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="no">echo Running test</span>
      <span class="no">mkdir -p /tmp/test-results</span>
      <span class="no">make test</span>
</code></pre><h6 id='default-shell-options'><em>Default shell options</em></h6>
<p>For jobs that run on <strong>Linux</strong>, the default value of the <code>shell</code> option is <code>/bin/bash -eo pipefail</code> if <code>/bin/bash</code> is present in the build container. Otherwise it is <code>/bin/sh -eo pipefail</code>. The default shell is not a login shell (<code>--login</code> or <code>-l</code> are not specified). Hence, the shell will <strong>not</strong> source your <code>~/.bash_profile</code>, <code>~/.bash_login</code>, <code>~/.profile</code> files.</p>

<p>For jobs that run on <strong>macOS</strong>, the default shell is <code>/bin/bash --login -eo pipefail</code>. The shell is a non-interactive login shell. The shell will execute <code>/etc/profile/</code> followed by <code>~/.bash_profile</code> before every step.</p>

<p>For more information about which files are executed when bash is invocated, <a href="https://linux.die.net/man/1/bash">see the <code>INVOCATION</code> section of the <code>bash</code> manpage</a>.</p>

<p>Descriptions of the <code>-eo pipefail</code> options are provided in the right pane.</p>

<p><code>-e</code></p>

<blockquote>
<p>Exit immediately if a pipeline (which may consist of a single simple command), a subshell command enclosed in parentheses, or one of the commands executed as part of a command list enclosed by braces exits with a non-zero status.</p>
</blockquote>

<p>So if in the previous example <code>mkdir</code> failed to create a directory and returned a non-zero status, then command execution would be terminated, and the whole step would be marked as failed. If you desire the opposite behaviour, you need to add <code>set +e</code> in your <code>command</code> or override the default <code>shell</code> in your configuration map of <code>run</code>.</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="pi">-</span> <span class="na">run</span><span class="pi">:</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="no">echo Running test</span>
      <span class="no">set +e</span>
      <span class="no">mkdir -p /tmp/test-results</span>
      <span class="no">make test</span>

<span class="pi">-</span> <span class="na">run</span><span class="pi">:</span>
    <span class="na">shell</span><span class="pi">:</span> <span class="s">/bin/sh</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="no">echo Running test</span>
      <span class="no">mkdir -p /tmp/test-results</span>
      <span class="no">make test</span>
</code></pre>
<p><code>-o pipefail</code></p>

<blockquote>
<p>If pipefail is enabled, the pipeline’s return status is the value of the last (rightmost) command to exit with a non-zero status, or zero if all commands exit successfully. The shell waits for all commands in the pipeline to terminate before returning a value.</p>
</blockquote>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">make test | tee test-output.log</span>
</code></pre>
<p>If <code>make test</code> fails, the <code>-o pipefail</code> option will cause the whole step to fail. Without <code>-o pipefail</code>, the step will always run successfully because the result of the whole pipeline is determined by the last command (<code>tee test-output.log</code>), which will always return a zero status.</p>

<p>Note that even if <code>make test</code> fails the rest of pipeline will be executed.</p>

<p>If you want to avoid this behaviour, you can specify <code>set +o pipefail</code> in the command or override the whole <code>shell</code> (see example above).</p>

<p>In general, we recommend using the default options (<code>-eo pipefail</code>) because they show errors in intermediate commands and simplify debugging job failures. For convenience, the UI displays the used shell and all active options for each <code>run</code> step.</p>

<p>For more information, see the <a href="%7b%7b%20site.baseurl%20%7d%7d/2.0/using-shell-scripts/index.html">Using Shell Scripts</a> document.</p>
<h6 id='background-commands'><em>Background commands</em></h6>
<p>The <code>background</code> attribute enables you to configure commands to run in the background. Job execution will immediately proceed to the next step rather than waiting for return of a command with the <code>background</code> attribute set to <code>true</code>. This example shows the config for running the X virtual framebuffer in the background which is commonly required to run Selenium tests:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="pi">-</span> <span class="na">run</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Running X virtual framebuffer</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">Xvfb :99 -screen 0 1280x1024x24</span>
    <span class="na">background</span><span class="pi">:</span> <span class="s">true</span>

<span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">make test</span>
</code></pre><h6 id='shorthand-syntax'><em>Shorthand syntax</em></h6>
<p><code>run</code> has a very convenient shorthand syntax:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">make test</span>

<span class="c1"># shorthanded command can also have multiple lines</span>
<span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
    <span class="no">mkdir -p /tmp/test-results</span>
    <span class="no">make test</span>
</code></pre>
<p>In this case, <code>command</code> and <code>name</code> become the string value of <code>run</code>, and the rest of the config map for that <code>run</code> have their default values.</p>
<h6 id='the-when-attribute'>The <code>when</code> Attribute</h6>
<p>By default, CircleCI will execute job steps one at a time, in the order that they are defined in <code>config.yml</code>, until a step fails (returns a non-zero exit code). After a command fails, no further job steps will be executed.</p>

<p>Adding the <code>when</code> attribute to a job step allows you to override this default behaviour, and selectively run or skip steps depending on the status of the job.</p>

<p>The default value of <code>on_success</code> means that the step will run only if all of the previous steps have been successful (returned exit code 0).</p>

<p>A value of <code>always</code> means that the step will run regardless of the exit status of previous steps. This is useful if you have a task that you want to run regardless of whether the previous steps are successful or not. For example, you might have a job
step that needs to upload logs or code-coverage data somewhere.</p>

<p>A value of <code>on_fail</code> means that the step will run only if one of the preceding steps has failed (returns a non-zero exit code). It is common to use <code>on_fail</code> if you want to store some diagnostic data to help debug test failures, or to run custom notifications about the failure, such as sending emails or triggering alerts in chatrooms.</p>

<p><strong>Note</strong>: Some steps, such as <code>store_artifacts</code> and <code>store_test_results</code> will always run, even if a step has failed previously.</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="pi">-</span> <span class="na">run</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">Upload CodeCov.io Data</span>
    <span class="na">command</span><span class="pi">:</span> <span class="s">bash &lt;(curl -s https://codecov.io/bash) -F unittests</span>
    <span class="na">when</span><span class="pi">:</span> <span class="s">always</span> <span class="c1"># Uploads code coverage results, pass or fail</span>
</code></pre><h5 id='the-when-step-requires-version-2-1'><strong>The <code>when</code> Step</strong> (requires version: 2.1)</h5>
<p>A conditional step consists of a step with the key <code>when</code> or <code>unless</code>. Under the <code>when</code> key are the subkeys <code>condition</code> and <code>steps</code>. The purpose of the <code>when</code> step is customizing commands and job configuration to run on custom conditions (determined at config-compile time) that are checked before a workflow runs. See the <a href="../2.0/reusing-config/index.html#defining-conditional-steps">Conditional Steps section of the Reusing Config document</a> for more details.</p>

<table><thead>
<tr>
<th>Key</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>condition</td>
<td>Y</td>
<td>String</td>
<td>A parameter value</td>
</tr>
<tr>
<td>steps</td>
<td>Y</td>
<td>Sequence</td>
<td>A list of steps to execute when the condition is true</td>
</tr>
</tbody></table>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span> <span class="c1"># conditional steps may also be defined in `commands:`</span>
  <span class="na">job_with_optional_custom_checkout</span><span class="pi">:</span>
    <span class="na">parameters</span><span class="pi">:</span>
      <span class="na">custom_checkout</span><span class="pi">:</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
        <span class="na">default</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">machine</span><span class="pi">:</span> <span class="s">true</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">when</span><span class="pi">:</span>
          <span class="na">condition</span><span class="pi">:</span> <span class="s">&lt;&lt;parameters.custom_checkout&gt;&gt;</span>
          <span class="na">steps</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">echo "my custom checkout"</span>
      <span class="pi">-</span> <span class="na">unless</span><span class="pi">:</span>
          <span class="na">condition</span><span class="pi">:</span> <span class="s">&lt;&lt;parameters.custom_checkout&gt;&gt;</span>
          <span class="na">steps</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">checkout</span>
<span class="na">workflows</span><span class="pi">:</span>
  <span class="na">build-test-deploy</span><span class="pi">:</span>
    <span class="na">jobs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">job_with_optional_custom_checkout</span><span class="pi">:</span>
          <span class="na">custom_checkout</span><span class="pi">:</span> <span class="s2">"</span><span class="s">any</span><span class="nv"> </span><span class="s">non-empty</span><span class="nv"> </span><span class="s">string</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">truthy"</span>
      <span class="pi">-</span> <span class="s">job_with_optional_custom_checkout</span>
</code></pre><h5 id='using-pipeline-values'>Using <code>pipeline.</code> Values</h5>
<p>Pipeline values are available to all pipeline configurations and can be used without previous declaration. The pipeline values available are as follows:</p>

<table><thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>pipeline.id</td>
<td>A globally unique id representing for the pipeline</td>
</tr>
<tr>
<td>pipeline.number</td>
<td>A project unique integer id for the pipelin</td>
</tr>
<tr>
<td>pipeline.project.git_url</td>
<td>E.g. https://github.com/circleci/circleci-docs</td>
</tr>
<tr>
<td>pipeline.project.type</td>
<td>E.g. &quot;github&quot;</td>
</tr>
<tr>
<td>pipeline.git.tag</td>
<td>The tag triggering the pipeline</td>
</tr>
<tr>
<td>pipeline.git.branch</td>
<td>The branch triggering the pipeline</td>
</tr>
<tr>
<td>pipeline.git.revision</td>
<td>The current git revision</td>
</tr>
<tr>
<td>pipeline.git.base_revision</td>
<td>The previous git revision</td>
</tr>
</tbody></table>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">docker</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">circleci/node:latest</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">IMAGETAG</span><span class="pi">:</span> <span class="s">latest</span>
    <span class="na">working_directory</span><span class="pi">:</span> <span class="s">~/main</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">echo "This is pipeline ID &lt;&lt; pipeline.id &gt;&gt;"</span>
</code></pre><h5 id='using-when-in-workflows'><strong>Using <code>when</code> in Workflows</strong></h5>
<p>With CircleCI configuration v2.1, you may use a <code>when</code> clause (the inverse clause <code>unless</code> is also supported) under a workflow declaration with a truthy or falsy value to determine whether or not to run that workflow. The most common use of <code>when</code> is with CircleCI API v2 pipeline triggering with parameters.</p>

<p>This example configuration uses a pipeline parameter, <code>run_integration_tests</code> to drive the <code>integration_tests</code> workflow.</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="na">parameters</span><span class="pi">:</span>
  <span class="na">run_integration_tests</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>
    <span class="na">default</span><span class="pi">:</span> <span class="s">false</span>

<span class="na">jobs</span><span class="pi">:</span>
<span class="nn">...</span>
</code></pre>
<p>This example prevents the workflow <code>integration_tests</code> from running unless the tests are invoked explicitly when the pipeline is triggered with the following in the <code>POST</code> body:</p>
<pre class="highlight yaml tab-yaml"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2.1</span>

<span class="pi">{</span>
    <span class="s2">"</span><span class="s">parameters"</span><span class="pi">:</span> <span class="pi">{</span>
        <span class="s2">"</span><span class="s">run_integration_tests"</span><span class="pi">:</span> <span class="nv">true</span>
    <span class="pi">}</span>
<span class="pi">}</span>
</code></pre>
      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
          </div>
      </div>
    </div>
  </body>

<!-- Mirrored from circleci.com/docs/reference-2-1/ by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 12 Jun 2020 08:06:59 GMT -->
</html>
